<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Adega Pessoal M&M - Interactive Edition</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&family=Cormorant+Garamond:ital,wght@0,400;0,700;1,400&family=Great+Vibes&family=Lato:wght@300;400;700&family=Montserrat:wght@300;400;700&family=Open+Sans:wght@400;600&family=Playfair+Display:ital,wght@0,400;0,700;1,400&family=Orbitron:wght@400;700&display=swap" rel="stylesheet">

    <style>
        /* =========================================
           SISTEMA DE TEMAS
           ========================================= */
        :root {
            --theme-name: "Clássico";
            --bg-page: #f4f1ea;
            --card-bg: #ffffff;
            --primary: #722f37;
            --accent: #c5a059;
            --secondary: #9e4755;
            --text-main: #2c2c2c;
            --text-muted: #666666;
            --font-title: 'Playfair Display', serif;
            --font-body: 'Lato', sans-serif;
            --font-script: 'Great Vibes', cursive;
            --border-color: #e0d8c3;
            --shadow-color: rgba(114, 47, 55, 0.15);
            --wave-opacity: 0.4;
        }

        body.theme-modern {
            --theme-name: "Moderno";
            --bg-page: #f0f2f5;
            --card-bg: #ffffff;
            --primary: #2c3e50;
            --accent: #34495e;
            --secondary: #7f8c8d;
            --text-main: #1a1a1a;
            --text-muted: #7f8c8d;
            --font-title: 'Montserrat', sans-serif;
            --font-body: 'Open Sans', sans-serif;
            --font-script: 'Montserrat', sans-serif;
            --border-color: #dfe6e9;
            --shadow-color: rgba(0, 0, 0, 0.1);
            --wave-opacity: 0.8;
        }

        body.theme-rustic {
            --theme-name: "Rústico";
            --bg-page: #e8e4d9;
            --card-bg: #fdfbf7;
            --primary: #5d4037;
            --accent: #33691e;
            --secondary: #8d6e63;
            --text-main: #3e2723;
            --text-muted: #5d4037;
            --font-title: 'Cinzel', serif;
            --font-body: 'Cormorant Garamond', serif;
            --font-script: 'Great Vibes', cursive;
            --border-color: #bcaaa4;
            --shadow-color: rgba(93, 64, 55, 0.15);
            --wave-opacity: 0.6;
        }

        body.theme-rose {
            --theme-name: "Rosé";
            --bg-page: #fff0f5;
            --card-bg: #ffffff;
            --primary: #d81b60;
            --accent: #f48fb1;
            --secondary: #ad1457;
            --text-main: #4a4a4a;
            --text-muted: #888888;
            --font-title: 'Playfair Display', serif;
            --font-body: 'Open Sans', sans-serif;
            --font-script: 'Great Vibes', cursive;
            --border-color: #f8bbd0;
            --shadow-color: rgba(216, 27, 96, 0.1);
            --wave-opacity: 0.3;
        }

        body.theme-gold {
            --theme-name: "Premium";
            --bg-page: #1a1a1a;
            --card-bg: #fffcf5;
            --primary: #000000;
            --accent: #d4af37;
            --secondary: #b8860b;
            --text-main: #111111;
            --text-muted: #555555;
            --font-title: 'Cinzel', serif;
            --font-body: 'Lato', sans-serif;
            --font-script: 'Cormorant Garamond', serif;
            --border-color: #d4af37;
            --shadow-color: rgba(212, 175, 55, 0.2);
            --wave-opacity: 0.5;
        }

        body.theme-green {
            --theme-name: "Frescor";
            --bg-page: #f1f8e9;
            --card-bg: #ffffff;
            --primary: #2e7d32;
            --accent: #8bc34a;
            --secondary: #558b2f;
            --text-main: #1b5e20;
            --text-muted: #689f38;
            --font-title: 'Montserrat', sans-serif;
            --font-body: 'Lato', sans-serif;
            --font-script: 'Great Vibes', cursive;
            --border-color: #c5e1a5;
            --shadow-color: rgba(46, 125, 50, 0.1);
            --wave-opacity: 0.4;
        }

        /* TEMA 7: FORTALEZA DA SOLIDÃO (SUPERMAN) */
        body.theme-superman {
            --theme-name: "Kal-El";
            --bg-page: #f0f8ff;       /* Alice Blue (Gelo) */
            --card-bg: #ffffff;
            --primary: #003D7C;       /* Azul Superman */
            --accent: #AC0D0D;        /* Vermelho Capa */
            --secondary: #F2B900;     /* Amarelo S */
            --text-main: #00274c;
            --text-muted: #5c7c99;
            --font-title: 'Orbitron', sans-serif; /* Futurista */
            --font-body: 'Montserrat', sans-serif;
            --font-script: 'Orbitron', sans-serif;
            --border-color: #89CFF0;  /* Cristal */
            --shadow-color: rgba(0, 61, 124, 0.2);
            --wave-opacity: 0.2;
        }

        /* =========================================
           ESTILOS GERAIS
           ========================================= */
        body {
            font-family: var(--font-body);
            background-color: var(--bg-page);
            color: var(--text-main);
            margin: 0;
            padding: 40px;
            -webkit-print-color-adjust: exact;
            print-color-adjust: exact;
            transition: background-color 0.5s ease, color 0.5s ease;
        }

        .catalog-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 50px;
            max-width: 950px; 
            margin: 0 auto;
        }

        /* =========================================
           ESTRUTURA 3D FLIP CARD
           ========================================= */
        .wine-card-container {
            perspective: 1000px; /* Profundidade 3D */
            height: 550px; /* Altura fixa necessária para o flip */
            page-break-inside: avoid;
        }

        .wine-card-inner {
            position: relative;
            width: 100%;
            height: 100%;
            text-align: center;
            transition: transform 0.8s;
            transform-style: preserve-3d;
            border-radius: 12px;
            box-shadow: 0 15px 30px var(--shadow-color);
        }

        /* Efeito de Giro ao passar o mouse */
        .wine-card-container:hover .wine-card-inner {
            transform: rotateY(180deg);
        }

        /* Faces Frente e Verso */
        .wine-card-front, .wine-card-back {
            position: absolute;
            width: 100%;
            height: 100%;
            -webkit-backface-visibility: hidden;
            backface-visibility: hidden;
            background-color: var(--card-bg);
            border-radius: 12px;
            border: 1px solid var(--border-color);
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        /* --- FRENTE DO CARD --- */
        .wine-card-front {
            z-index: 2;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .front-photo {
            height: 380px;
            object-fit: contain;
            filter: drop-shadow(5px 5px 10px rgba(0,0,0,0.3));
            transition: transform 0.3s;
            z-index: 2;
        }
        
        .wine-card-container:hover .front-photo { transform: scale(1.05); }

        .front-info {
            text-align: center;
            margin-top: 20px;
            z-index: 2;
        }

        /* Estrelas de Rating */
        .rating-stars {
            color: #ddd;
            font-size: 1.5em;
            cursor: pointer;
            margin-top: 10px;
            display: inline-block;
        }
        .rating-stars span { transition: color 0.2s; }
        .rating-stars span:hover, .rating-stars span.active { color: #f1c40f; }

        /* --- VERSO DO CARD (Detalhes) --- */
        .wine-card-back {
            transform: rotateY(180deg);
            padding: 30px;
            text-align: left;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        /* Elementos Decorativos */
        .card-wave-top {
            background-color: var(--primary);
            height: 15px;
            width: 100%;
            mask-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 1200 120' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M321.39,56.44c58-10.79,114.16-30.13,172-41.86,82.39-16.72,168.19-17.73,250.45-.39C823.78,31,906.67,72,985.66,92.83c70.05,18.48,146.53,26.09,214.34,3V0H0V27.35A600.21,600.21,0,0,0,321.39,56.44Z'/%3E%3C/svg%3E");
            -webkit-mask-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 1200 120' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M321.39,56.44c58-10.79,114.16-30.13,172-41.86,82.39-16.72,168.19-17.73,250.45-.39C823.78,31,906.67,72,985.66,92.83c70.05,18.48,146.53,26.09,214.34,3V0H0V27.35A600.21,600.21,0,0,0,321.39,56.44Z'/%3E%3C/svg%3E");
            mask-size: cover;
            -webkit-mask-size: cover;
            opacity: var(--wave-opacity);
            z-index: 5;
            position: absolute;
            top: 0;
            left: 0;
        }
        
        .card-top-solid {
            height: 10px;
            width: 100%;
            background-color: var(--primary);
            position: absolute;
            top: 0;
            z-index: 4;
        }

        .bg-text-top {
            position: absolute;
            top: -0.1em; 
            left: 50%;
            transform: translateX(-50%);
            width: 100%;
            text-align: center;
            font-family: var(--font-title);
            font-weight: 700;
            font-size: 5em; 
            color: var(--primary);
            opacity: 0.04; 
            white-space: nowrap;
            z-index: 0;
            pointer-events: none;
            overflow: hidden;
            line-height: 1;
        }

        /* HEADER & FILTROS */
        .header-card-body {
            min-height: 500px;
            padding: 40px;
            text-align: center;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            position: relative;
            background: var(--card-bg);
            border-radius: 12px;
            border: 1px solid var(--border-color);
            box-shadow: 0 15px 30px var(--shadow-color);
        }

        .header-icon {
            width: 100px;
            height: 100px;
            fill: var(--primary);
            margin-bottom: 30px;
        }

        h1.main-title {
            font-family: var(--font-title);
            color: var(--primary);
            font-size: 4.5em;
            margin: 0;
            letter-spacing: 3px;
            text-transform: uppercase;
            line-height: 1.1;
        }

        p.main-subtitle {
            font-family: var(--font-script);
            color: var(--accent);
            font-size: 2.5em;
            margin-top: 10px;
        }

        /* FILTROS */
        .filter-container {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            padding: 10px 0;
            align-items: center;
            justify-content: center;
            background: transparent;
            border-bottom: 1px solid var(--border-color);
            margin-bottom: 30px;
            margin-top: 20px;
        }

        .filter-input, .filter-select {
            padding: 8px 10px;
            border: 1px solid transparent;
            border-bottom: 2px solid var(--border-color);
            border-radius: 4px;
            font-family: var(--font-body);
            font-size: 0.9em;
            color: var(--text-main);
            background-color: rgba(255, 255, 255, 0.5);
            outline: none;
            transition: all 0.3s;
            min-width: 140px;
        }

        .filter-input:focus, .filter-select:focus {
            border-bottom-color: var(--primary);
            background-color: var(--card-bg);
        }

        /* TEXTOS & GRIDS NO VERSO */
        .wine-name { 
            font-family: var(--font-title);
            font-size: 2em; 
            font-weight: 700; 
            color: var(--primary); 
            line-height: 1;
            margin-bottom: 5px;
        }
        
        .wine-region { 
            color: var(--accent); 
            font-weight: 700; 
            text-transform: uppercase; 
            font-size: 0.9em; 
            letter-spacing: 2px;
            margin-bottom: 20px;
        }

        .poetic-desc {
            font-family: var(--font-title);
            font-style: italic;
            color: var(--text-muted);
            font-size: 1.1em;
            line-height: 1.5;
            margin-bottom: 20px;
            padding-left: 15px;
            border-left: 3px solid var(--secondary);
        }

        .tech-grid {
            display: grid;
            grid-template-columns: 2fr 1fr 1fr;
            gap: 10px;
            background-color: rgba(0,0,0,0.02);
            padding: 10px;
            border-radius: 8px;
            border: 1px solid var(--border-color);
            margin-bottom: 15px;
        }

        .tech-item {
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 0.85em;
            color: var(--text-main);
        }

        .strength-wrapper { margin-top: auto; }
        .strength-track {
            background-color: #e0e0e0;
            border-radius: 20px;
            height: 8px;
            width: 100%;
            overflow: hidden;
        }
        .strength-fill {
            height: 100%;
            border-radius: 20px;
            background: linear-gradient(90deg, var(--accent) 0%, var(--primary) 100%);
            width: 0%; 
        }

        /* BOTÕES FLUTUANTES */
        .fab-container {
            position: fixed;
            bottom: 20px;
            right: 20px;
            display: flex;
            flex-direction: column;
            gap: 15px;
            z-index: 9999;
        }

        .fab {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background-color: var(--primary);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
            cursor: pointer;
            transition: all 0.3s;
            opacity: 0.4;
            border: 2px solid white;
        }

        .fab:hover { opacity: 1; transform: scale(1.1); }
        .fab svg { width: 24px; height: 24px; fill: white; }

        /* MODAL DASHBOARD */
        .modal {
            display: none; 
            position: fixed; 
            z-index: 10000; 
            left: 0;
            top: 0;
            width: 100%; 
            height: 100%; 
            background-color: rgba(0,0,0,0.6); 
            backdrop-filter: blur(5px);
        }

        .modal-content {
            background-color: var(--card-bg);
            margin: 10% auto; 
            padding: 30px;
            border: 1px solid var(--border-color);
            border-radius: 12px;
            width: 80%;
            max-width: 600px;
            box-shadow: 0 20px 50px rgba(0,0,0,0.5);
            font-family: var(--font-body);
            color: var(--text-main);
        }

        .close-modal {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }
        .close-modal:hover { color: var(--primary); }

        .dashboard-stats {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 20px;
        }
        .stat-box {
            background: rgba(0,0,0,0.03);
            padding: 15px;
            border-radius: 8px;
            text-align: center;
        }
        .stat-value { font-size: 2em; font-weight: bold; color: var(--primary); font-family: var(--font-title); }
        .stat-label { font-size: 0.9em; color: var(--text-muted); text-transform: uppercase; }

        /* IMPRESSÃO (Remove 3D, mostra lista plana) */
        @media print {
            body { background-color: white; padding: 0; }
            .no-print { display: none !important; }
            
            .catalog-grid { display: block; }
            .wine-card-container { 
                height: auto; 
                perspective: none; 
                margin-bottom: 40px; 
                page-break-inside: avoid;
            }
            .wine-card-inner { 
                transform: none !important; 
                box-shadow: none; 
                border: 1px solid #ccc;
                display: flex;
                flex-direction: row;
                text-align: left;
            }
            .wine-card-front {
                position: relative;
                width: 200px;
                height: auto;
                border: none;
                flex: 0 0 200px;
            }
            .wine-card-back {
                position: relative;
                transform: none;
                width: auto;
                height: auto;
                border: none;
                flex: 1;
                display: flex;
            }
            /* Esconde elementos duplicados na impressão */
            .bg-text-top { opacity: 0.1 !important; }
            .front-info { display: none; } /* Só mostra a foto na esquerda */
        }
    </style>
</head>
<body class="">

    <div class="fab-container no-print">
        <div class="fab" onclick="openDashboard()" title="Dashboard Analítico">
            <svg viewBox="0 0 24 24"><path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM9 17H7v-7h2v7zm4 0h-2V7h2v10zm4 0h-2v-4h2v4z"/></svg>
        </div>
        <div class="fab" onclick="randomWine()" title="Sommelier da Sorte">
            <svg viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 17h-2v-2h2v2zm2.07-7.75l-.9.92C13.45 12.9 13 13.5 13 15h-2v-.5c0-1.1.45-2.1 1.17-2.83l1.24-1.26c.37-.36.59-.86.59-1.41 0-1.1-.9-2-2-2s-2 .9-2 2H8c0-2.21 1.79-4 4-4s4 1.79 4 4c0 .88-.36 1.68-.93 2.25z"/></svg>
        </div>
        <div class="fab" onclick="toggleTheme()" title="Mudar Identidade Visual">
            <svg viewBox="0 0 24 24"><path d="M12 3c-4.97 0-9 4.03-9 9s4.03 9 9 9c.83 0 1.5-.67 1.5-1.5 0-.39-.15-.74-.39-1.01-.23-.26-.38-.61-.38-.99 0-.83.67-1.5 1.5-1.5H16c2.76 0 5-2.24 5-5 0-4.42-4.03-8-9-8zm-5.5 9c-.83 0-1.5-.67-1.5-1.5S5.67 9 6.5 9 8 9.67 8 10.5 7.33 12 6.5 12zm3-4C8.67 8 8 7.33 8 6.5S8.67 5 9.5 5s1.5.67 1.5 1.5S10.33 8 9.5 8zm5 0c-.83 0-1.5-.67-1.5-1.5S13.67 5 14.5 5s1.5.67 1.5 1.5S15.33 8 14.5 8zm3 4c-.83 0-1.5-.67-1.5-1.5S16.67 9 17.5 9s1.5.67 1.5 1.5S18.33 12 17.5 12z"/></svg>
        </div>
    </div>

    <div id="biModal" class="modal no-print">
        <div class="modal-content">
            <span class="close-modal" onclick="closeDashboard()">&times;</span>
            <h2 style="color: var(--primary); font-family: var(--font-title); text-align: center;">Dashboard da Adega</h2>
            <div class="dashboard-stats">
                <div class="stat-box">
                    <div class="stat-value" id="kpi-total">0</div>
                    <div class="stat-label">Rótulos Totais</div>
                </div>
                <div class="stat-box">
                    <div class="stat-value" id="kpi-abv">0%</div>
                    <div class="stat-label">Álcool Médio</div>
                </div>
                <div class="stat-box">
                    <div class="stat-value" id="kpi-country">-</div>
                    <div class="stat-label">País Dominante</div>
                </div>
                <div class="stat-box">
                    <div class="stat-value" id="kpi-strong">0</div>
                    <div class="stat-label">Vinhos Encorpados (4-5)</div>
                </div>
            </div>
        </div>
    </div>

    <div class="catalog-grid">
        <div class="header-card-body">
            <svg class="header-icon" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M19.5,5.5A3.5,3.5 0 1,0 16,9H16L16,9.16C15.86,9.58 15.58,9.91 15.22,10.1C15.5,10.5 15.56,11.05 15.35,11.53C16.14,12.12 16.5,13.14 16.27,14.12C16.71,14.54 17,15.12 17,15.75A2.25,2.25 0 0,1 14.75,18C14.75,18.66 14.4,19.25 13.88,19.6C13.96,19.95 13.9,20.33 13.7,20.64C13.53,20.89 13.25,21.05 12.95,21.05H11.05C10.66,21.05 10.33,20.77 10.23,20.4C10.03,20.5 9.8,20.55 9.57,20.53C8.68,20.46 7.96,19.75 7.96,18.88C7.55,18.82 7.18,18.61 6.9,18.29C5.83,18.3 4.96,17.43 4.96,16.36C4.96,15.81 5.19,15.31 5.57,14.95C5.17,14.34 5.09,13.56 5.37,12.87C5.12,12.35 5.17,11.72 5.5,11.23C5.15,10.6 5.25,9.8 5.72,9.27C5.55,8.83 5.59,8.34 5.83,7.94C6.46,6.92 7.72,6.5 8.85,6.96C9.15,5.84 10.18,5 11.41,5C11.53,5 11.64,5.03 11.76,5.04C12.06,3.84 13.13,2.95 14.41,2.95C15.82,2.95 16.96,4.09 16.96,5.5H16.95C17.75,5.1 18.71,5.1 19.5,5.5Z" />
            </svg>
            <h1 class="main-title">Adega Pessoal M&M</h1>
            <p class="main-subtitle">Coleção Selecionada &bull; Catálogo Analítico</p>
            
            <div class="filter-container no-print">
                <input type="text" id="searchInput" class="filter-input" placeholder="Buscar..." oninput="applyFilters()">
                <select id="countrySelect" class="filter-select" onchange="applyFilters()"><option value="">Países</option></select>
                <select id="yearSelect" class="filter-select" onchange="applyFilters()"><option value="">Safras</option></select>
                <select id="strengthSelect" class="filter-select" onchange="applyFilters()">
                    <option value="">Corpo</option>
                    <option value="1">1 - Suave</option>
                    <option value="3">3 - Médio</option>
                    <option value="5">5 - Robusto</option>
                </select>
                <div class="filter-stats" id="filterStats"></div>
            </div>
        </div>

        <div id="wineListContainer" style="display: contents;"></div>
    </div>

    <script>
        // DADOS COMPLETOS
        const flags = {
            "Portugal": `<svg viewBox="0 0 600 400" xmlns="http://www.w3.org/2000/svg"><path fill="#f00" d="M0 0h600v400H0z"/><path fill="#006600" d="M0 0h240v400H0z"/><g transform="translate(240 200)"><circle fill="#ff0" r="88"/><path fill="#fff" d="M-50-60h100v100c0 40-20 60-50 60s-50-20-50-60z"/><path fill="#f00" d="M-40-50h80v90c0 30-10 40-40 40s-40-10-40-40z"/><path fill="#003399" d="M-25-30h10v10h-10zm20 0h10v10h-10zm20 0h10v10h-10zm-40 20h10v10h-10zm20 0h10v10h-10zm20 0h10v10h-10zm-40 20h10v10h-10zm20 0h10v10h-10zm20 0h10v10h-10z"/></g></svg>`,
            "Espanha": `<svg viewBox="0 0 750 500" xmlns="http://www.w3.org/2000/svg"><path fill="#AA151B" d="M0 0h750v500H0z"/><path fill="#F1BF00" d="M0 125h750v250H0z"/><g transform="translate(150 160) scale(0.6)"><path fill="#FFF" d="M0 0h100v100H0z" stroke="#000"/><path fill="#AA151B" d="M10 10h80v80H10z"/></g></svg>`,
            "Chile": `<svg viewBox="0 0 900 600" xmlns="http://www.w3.org/2000/svg"><path fill="#d52b1e" d="M0 300h900v300H0z"/><path fill="#fff" d="M300 0h600v300H300z"/><path fill="#0039a6" d="M0 0h300v300H0z"/><path fill="#fff" d="M150 85l47 145h-152l123-89-47 145 47-145-123-89h152z"/></svg>`,
            "Argentina": `<svg viewBox="0 0 900 600" xmlns="http://www.w3.org/2000/svg"><path fill="#75aadb" d="M0 0h900v600H0z"/><path fill="#fff" d="M0 200h900v200H0z"/><circle cx="450" cy="300" r="40" fill="#f6b40e"/></svg>`,
            "França": `<svg viewBox="0 0 900 600" xmlns="http://www.w3.org/2000/svg"><path fill="#ED2939" d="M0 0h900v600H0z"/><path fill="#fff" d="M0 0h600v600H0z"/><path fill="#002395" d="M0 0h300v600H0z"/></svg>`,
            "Itália": `<svg viewBox="0 0 900 600" xmlns="http://www.w3.org/2000/svg"><path fill="#CE2B37" d="M0 0h900v600H0z"/><path fill="#fff" d="M0 0h600v600H0z"/><path fill="#009246" d="M0 0h300v600H0z"/></svg>`,
            "Brasil": `<svg viewBox="0 0 700 500" xmlns="http://www.w3.org/2000/svg"><rect width="700" height="500" fill="#009c3b"/><path d="M350 35L665 250L350 465L35 250Z" fill="#ffdf00"/><circle cx="350" cy="250" r="125" fill="#002776"/><path d="M240 250 A 200 200 0 0 0 550 200" stroke="#fff" stroke-width="15" fill="none"/></svg>`
        };

        const iconGrapes = `<svg class="tech-icon" viewBox="0 0 24 24"><path d="M19.5,5.5A3.5,3.5 0 1,0 16,9H16L16,9.16C15.86,9.58 15.58,9.91 15.22,10.1C15.5,10.5 15.56,11.05 15.35,11.53C16.14,12.12 16.5,13.14 16.27,14.12C16.71,14.54 17,15.12 17,15.75A2.25,2.25 0 0,1 14.75,18C14.75,18.66 14.4,19.25 13.88,19.6C13.96,19.95 13.9,20.33 13.7,20.64C13.53,20.89 13.25,21.05 12.95,21.05H11.05C10.66,21.05 10.33,20.77 10.23,20.4C10.03,20.5 9.8,20.55 9.57,20.53C8.68,20.46 7.96,19.75 7.96,18.88C7.55,18.82 7.18,18.61 6.9,18.29C5.83,18.3 4.96,17.43 4.96,17.36C4.96,15.81 5.19,15.31 5.57,14.95C5.17,14.34 5.09,13.56 5.37,12.87C5.12,12.35 5.17,11.72 5.5,11.23C5.15,10.6 5.25,9.8 5.72,9.27C5.55,8.83 5.59,8.34 5.83,7.94C6.46,6.92 7.72,6.5 8.85,6.96C9.15,5.84 10.18,5 11.41,5C11.53,5 11.64,5.03 11.76,5.04C12.06,3.84 13.13,2.95 14.41,2.95C15.82,2.95 16.96,4.09 16.96,5.5H16.95C17.75,5.1 18.71,5.1 19.5,5.5Z" /></svg>`;
        const iconDrop = `<svg class="tech-icon" viewBox="0 0 24 24"><path d="M12,2c-5.33,5.33-8,10.67-8,16c0,4.42,3.58,8,8,8s8-3.58,8-8C20,12.67,17.33,7.33,12,2z M12,24c-3.31,0-6-2.69-6-6c0-4,2-8,6-12c4,4,6,8,6,12C18,21.31,15.31,24,12,24z"/></svg>`;
        const iconCalendar = `<svg class="tech-icon" viewBox="0 0 24 24"><path d="M19 4h-1V2h-2v2H8V2H6v2H5c-1.11 0-1.99.9-1.99 2L3 20c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 16H5V10h14v10zM9 14H7v-2h2v2zm4 0h-2v-2h2v2zm4 0h-2v-2h2v2zm-8 4H7v-2h2v2zm4 0h-2v-2h2v2zm4 0h-2v-2h2v2z"/></svg>`;

        const vinhos = [
            {
                nome: "Popolo Private Selection",
                pais: "Portugal",
                regiao: "Regional Alentejano",
                uvas: "Syrah, Aragonez, Trincadeira, Touriga Nacional",
                abv: "13,5%",
                safra: "2023",
                forca: 5,
                poesia: "Um gigante gentil das planícies quentes do Alentejo. Este vinho traz o sol português engarrafado: potente, escuro e carregado de frutas maduras, como um abraço caloroso em dia de inverno.",
                imgFrente: "images/20251202_111906.jpg", imgVerso: "images/20251202_111914.jpg"
            },
            {
                nome: "Duque de Cazarra Roble",
                pais: "Espanha",
                regiao: "Utiel-Requena",
                uvas: "Bobal, Tempranillo, Cabernet Sauvignon",
                abv: "13,0%",
                safra: "2022",
                forca: 5,
                poesia: "A essência da terra espanhola maturada em carvalho. 'Roble' denota sua passagem pela madeira, conferindo-lhe uma espinha dorsal firme e notas de baunilha que dançam com a rusticidade da uva Bobal.",
                imgFrente: "images/20251202_112052.jpg", imgVerso: "images/20251202_112058.jpg"
            },
            {
                nome: "La Tirana",
                pais: "Chile",
                regiao: "Valle Central",
                uvas: "Carmenere",
                abv: "13,5%",
                safra: "2024",
                forca: 4,
                poesia: "A casta perdida de Bordeaux que encontrou sua alma nos Andes. Marcante por suas notas de especiarias e pimentão doce, é um vinho aveludado que conta a história do terroir chileno em cada gole.",
                imgFrente: "images/20251202_111934.jpg", imgVerso: "images/20251202_111940.jpg"
            },
            {
                nome: "Casal da Torre",
                pais: "Portugal",
                regiao: "Douro DOC",
                uvas: "Touriga Franca, Tinta Roriz, Tinto Cão",
                abv: "13,0%",
                safra: "2023",
                forca: 4,
                poesia: "Filho das encostas íngremes e do solo de xisto do Douro. Um vinho sério e mineral, onde a elegância tenta domar a força bruta das uvas que nascem na região vinícola mais antiga do mundo.",
                imgFrente: "images/20251202_111706.jpg", imgVerso: "images/20251202_111714.jpg"
            },
            {
                nome: "Montis Anima",
                pais: "Argentina",
                regiao: "Mendoza",
                uvas: "Malbec",
                abv: "13,0%",
                safra: "2024",
                forca: 4,
                poesia: "'A Alma da Montanha'. Um Malbec de altitude que equilibra a doçura natural da ameixa madura com o frescor do ar dos Andes. Sedoso, violeta e profundamente satisfatório.",
                imgFrente: "images/20251202_112148.jpg", imgVerso: "images/20251202_112205.jpg"
            },
            {
                nome: "Encostas do Outeiro",
                pais: "Portugal",
                regiao: "Regional Lisboa",
                uvas: "Syrah, Caladoc, Aragonez",
                abv: "13,0%",
                safra: "2022",
                forca: 4,
                poesia: "Um sopro do Atlântico. Cultivado sob a influência da brisa oceânica de Lisboa, é um vinho que une a estrutura da Syrah com uma frescura salina vibrante, perfeito para a gastronomia.",
                imgFrente: "images/20251202_112124.jpg", imgVerso: "images/20251202_112131.jpg"
            },
            {
                nome: "Le Gourmandin",
                pais: "França",
                regiao: "Vin de France",
                uvas: "Blend Tinto Fino",
                abv: "13,0%",
                safra: "2023",
                forca: 3,
                poesia: "O cavalheiro francês descomplicado. Como um bistrô parisiense, não exige formalidades: entrega equilíbrio, fruta honesta e aquele 'je ne sais quoi' que convida sempre à próxima taça.",
                imgFrente: "images/20251202_112246.jpg", imgVerso: "images/20251202_112252.jpg"
            },
            {
                nome: "Beco Torto",
                pais: "Portugal",
                regiao: "Regional Lisboa",
                uvas: "Blend Regional",
                abv: "13,0%",
                safra: "2022",
                forca: 3,
                poesia: "Assim como as ruelas sinuosas de Lisboa, este vinho é uma descoberta charmosa. Frutado, macio e sem arestas, é feito para conversas longas e descomplicadas entre amigos.",
                imgFrente: "images/20251202_112027.jpg", imgVerso: "images/20251202_112034.jpg"
            },
             {
                nome: "Emarè Sangiovese",
                pais: "Itália",
                regiao: "Rubicone IGT",
                uvas: "Sangiovese",
                abv: "12,5%",
                safra: "2024",
                forca: 3,
                poesia: "A alma rústica da Itália. Com a acidez típica da Sangiovese que 'limpa' o paladar, traz notas de cereja ácida e terra molhada. Um vinho que implora por um prato de massa ao sugo.",
                imgFrente: "images/20251202_111845.jpg", imgVerso: "images/20251202_111852.jpg"
            },
            {
                nome: "Emarè Montepulciano",
                pais: "Itália",
                regiao: "D'Abruzzo DOC",
                uvas: "Montepulciano",
                abv: "12,5%",
                safra: "2024",
                forca: 3,
                poesia: "Escuro como a noite em Abruzzo, mas vibrante no paladar. Um tinto gastronômico, com taninos presentes e um final levemente amargo que é a assinatura de autenticidade italiana.",
                imgFrente: "images/20251202_111820.jpg", imgVerso: "images/20251202_111832.jpg"
            },
            {
                nome: "Vivalti Rosé",
                pais: "Brasil",
                regiao: "São Joaquim - SC",
                uvas: "Sangiovese, Touriga Nacional",
                abv: "12,5%",
                safra: "2023",
                forca: 2,
                poesia: "O frescor das montanhas catarinenses. Um rosé de altitude, pálido e elegante, que captura o frio da serra em notas de frutas vermelhas frescas e acidez crocante.",
                imgFrente: "images/20251202_112003.jpg", imgVerso: "images/20251202_112008.jpg"
            },
            {
                nome: "Tozetti Casca Dura",
                pais: "Brasil",
                regiao: "Bituruna - PR",
                uvas: "Casca Dura",
                abv: "12,5%",
                safra: "2025",
                forca: 2,
                poesia: "Uma relíquia viva da imigração italiana no Paraná. A uva Casca Dura, resistente e rara, entrega um vinho branco com personalidade única, história e a resiliência de Bituruna.",
                imgFrente: "images/20251202_111754.jpg", imgVerso: "images/20251202_111804.jpg"
            },
             {
                nome: "Duque de Cazarra (Vendimia)",
                pais: "Espanha",
                regiao: "Tierra de Castilla",
                uvas: "Tempranillo",
                abv: "12,5%",
                safra: "2022",
                forca: 3,
                poesia: "A juventude vibrante da Espanha. Sem a maquiagem da madeira, a uva Tempranillo se mostra nua e crua: fruta vermelha explosiva, alegre e direta ao ponto.",
                imgFrente: "images/20251202_112223.jpg", imgVerso: "images/20251202_112229.jpg"
            },
            {
                nome: "Sanber Bordô Suave",
                pais: "Brasil",
                regiao: "Bituruna - PR",
                uvas: "Bordô",
                abv: "11,0%",
                safra: "NV",
                forca: 1,
                poesia: "O sabor da memória. Um vinho de cor violeta profunda que remete às festas de família. Doce, intenso e despretensioso, é o conforto de casa em forma líquida.",
                imgFrente: "images/20251202_111735.jpg", imgVerso: "images/20251202_111735.jpg" 
            },
            {
                nome: "Bituruna Niágara Suave",
                pais: "Brasil",
                regiao: "Bituruna - PR",
                uvas: "Niágara",
                abv: "10,7%",
                safra: "NV",
                forca: 1,
                poesia: "Um jardim em flor. O aroma inconfundível da uva Niágara explode na taça como um perfume adocicado. Leve e fácil, é a simplicidade doce de uma tarde de verão.",
                imgFrente: "images/20251202_111725.jpg", imgVerso: "images/20251202_111725.jpg"
            }
        ];

        // POVOAR FILTROS
        function populateFilters() {
            const countries = new Set(vinhos.map(v => v.pais).sort());
            const years = new Set(vinhos.map(v => v.safra).sort());
            
            const cSelect = document.getElementById('countrySelect');
            const ySelect = document.getElementById('yearSelect');

            countries.forEach(val => cSelect.innerHTML += `<option value="${val}">${val}</option>`);
            years.forEach(val => ySelect.innerHTML += `<option value="${val}">${val}</option>`);
        }

        // OBTER RATING SALVO
        function getRating(wineName) {
            return parseInt(localStorage.getItem(`rating_${wineName}`) || 0);
        }

        // SALVAR RATING
        function setRating(wineName, rating) {
            localStorage.setItem(`rating_${wineName}`, rating);
            applyFilters(); // Re-renderiza para atualizar visual
        }

        // RENDERIZAR CATÁLOGO (COM FLIP 3D E RATING)
        function renderCatalog(listToRender) {
            const container = document.getElementById('wineListContainer');
            container.innerHTML = ''; 

            const stats = document.getElementById('filterStats');
            stats.textContent = `Exibindo ${listToRender.length} rótulos`;

            listToRender.forEach(vinho => {
                const cardContainer = document.createElement('div');
                cardContainer.className = 'wine-card-container';
                const flagSVG = flags[vinho.pais] || '';
                const widthPercentage = (vinho.forca / 5) * 100;
                const userRating = getRating(vinho.nome);

                // Gerar estrelas
                let starsHTML = '<div class="rating-stars no-print">';
                for(let i=1; i<=5; i++) {
                    const activeClass = i <= userRating ? 'active' : '';
                    // Onclick previne a virada do card
                    starsHTML += `<span class="${activeClass}" onclick="event.stopPropagation(); setRating('${vinho.nome}', ${i})">★</span>`;
                }
                starsHTML += '</div>';

                cardContainer.innerHTML = `
                    <div class="wine-card-inner">
                        <div class="wine-card-front">
                            <div class="card-top-solid"></div>
                            <div class="bg-text-top">${vinho.nome}</div>
                            <div style="flex:1; display:flex; align-items:center; justify-content:center; width:100%;">
                                <img src="${vinho.imgFrente}" class="front-photo" alt="${vinho.nome}" onerror="this.style.display='none'">
                            </div>
                            <div class="front-info">
                                <div style="width:40px; height:25px; margin:0 auto 10px auto; border:1px solid #ddd; border-radius:3px; overflow:hidden;">${flagSVG}</div>
                                <h2 class="wine-name" style="font-size:1.5em; margin:0;">${vinho.nome}</h2>
                                ${starsHTML}
                            </div>
                        </div>

                        <div class="wine-card-back">
                            <div class="card-wave-top"></div>
                            <div class="info">
                                <div class="wine-header">
                                    <div class="flag-wrapper">
                                        <div class="flag-box">${flagSVG}</div>
                                        <div class="country-name">${vinho.pais}</div>
                                    </div>
                                    <div class="wine-titles">
                                        <h2 class="wine-name">${vinho.nome}</h2>
                                        <div class="wine-region">${vinho.regiao}</div>
                                    </div>
                                </div>
                                
                                <div class="poetic-desc">"${vinho.poesia}"</div>

                                <div class="tech-grid">
                                    <div class="tech-item">${iconGrapes}<span><span class="label">Uva:</span> ${vinho.uvas}</span></div>
                                    <div class="tech-item">${iconCalendar}<span><span class="label">Safra:</span> ${vinho.safra}</span></div>
                                    <div class="tech-item">${iconDrop}<span><span class="label">Vol:</span> ${vinho.abv}</span></div>
                                </div>

                                <div style="display:flex; justify-content:center; margin-bottom:10px;">
                                    <img src="${vinho.imgVerso}" style="height:120px; border:1px solid #eee; border-radius:4px;" onerror="this.style.display='none'">
                                </div>

                                <div class="strength-wrapper">
                                    <div class="strength-label"><span>Corpo</span> <span>${vinho.forca}/5</span></div>
                                    <div class="strength-track"><div class="strength-fill" style="width: ${widthPercentage}%"></div></div>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
                container.appendChild(cardContainer);
            });
        }

        // LÓGICA FILTROS
        function applyFilters() {
            const searchText = document.getElementById('searchInput').value.toLowerCase();
            const countryVal = document.getElementById('countrySelect').value;
            const yearVal = document.getElementById('yearSelect').value;
            const strengthVal = document.getElementById('strengthSelect').value;

            const filtered = vinhos.filter(v => {
                const matchText = v.nome.toLowerCase().includes(searchText) || v.uvas.toLowerCase().includes(searchText);
                const matchCountry = countryVal === "" || v.pais === countryVal;
                const matchYear = yearVal === "" || v.safra === yearVal;
                const matchStrength = strengthVal === "" || v.forca.toString() === strengthVal;
                return matchText && matchCountry && matchYear && matchStrength;
            });
            renderCatalog(filtered);
        }

        // TEMAS (Incluindo Superman)
        const themes = [
            { class: '', name: 'Clássico' },
            { class: 'theme-modern', name: 'Moderno' },
            { class: 'theme-rustic', name: 'Rústico' },
            { class: 'theme-rose', name: 'Rosé' },
            { class: 'theme-gold', name: 'Premium' },
            { class: 'theme-green', name: 'Frescor' },
            { class: 'theme-superman', name: 'Kal-El' }
        ];
        
        let currentThemeIndex = parseInt(localStorage.getItem('wineCatalogTheme') || 0);
        if(currentThemeIndex >= themes.length) currentThemeIndex = 0;

        function applyTheme() {
            document.body.className = themes[currentThemeIndex].class;
            // Opcional: Mostrar nome do tema em algum lugar se quiser
        }

        function toggleTheme() {
            currentThemeIndex = (currentThemeIndex + 1) % themes.length;
            localStorage.setItem('wineCatalogTheme', currentThemeIndex);
            applyTheme();
        }

        // DASHBOARD BI
        function openDashboard() {
            // Calcular Stats
            document.getElementById('kpi-total').innerText = vinhos.length;
            
            // ABV Médio
            let totalAbv = 0;
            vinhos.forEach(v => totalAbv += parseFloat(v.abv.replace(',','.').replace('%','')));
            document.getElementById('kpi-abv').innerText = (totalAbv / vinhos.length).toFixed(1) + '%';

            // Top País
            const counts = {};
            vinhos.forEach(v => counts[v.pais] = (counts[v.pais] || 0) + 1);
            const topCountry = Object.keys(counts).reduce((a, b) => counts[a] > counts[b] ? a : b);
            document.getElementById('kpi-country').innerText = topCountry;

            // Fortes
            const strong = vinhos.filter(v => v.forca >= 4).length;
            document.getElementById('kpi-strong').innerText = strong;

            document.getElementById('biModal').style.display = "block";
        }

        function closeDashboard() { document.getElementById('biModal').style.display = "none"; }

        // SOMMELIER DA SORTE
        function randomWine() {
            const randIndex = Math.floor(Math.random() * vinhos.length);
            const wine = vinhos[randIndex];
            
            // Mensagem humor inglês
            let msg = "";
            if(wine.forca <= 2) msg = `Sorteado: ${wine.nome}.\nUma escolha... prudente e leve, senhor.`;
            else if(wine.forca === 3) msg = `Sorteado: ${wine.nome}.\nEquilibrado. Nada muito arriscado hoje?`;
            else msg = `Sorteado: ${wine.nome}.\nExcelente! Uma escolha de peso e caráter.`;

            alert(msg);
            
            // Scroll até o vinho (se estiver visível no filtro)
            // Resetar filtros para garantir que ele apareça
            document.getElementById('searchInput').value = wine.nome;
            applyFilters();
        }

        // INICIALIZAÇÃO
        applyTheme();
        populateFilters();
        renderCatalog(vinhos);

        // Fechar modal ao clicar fora
        window.onclick = function(event) {
            if (event.target == document.getElementById('biModal')) closeDashboard();
        }
    </script>
</body>
</html>